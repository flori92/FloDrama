import{j as t,n as be,o as je,p as we,B as G,T as J,y as ke,z as Ne,E as Ce,M as Se,H as Pe,q as Ee,r as Te,e as Me,t as Le,i as K}from"./ui-components-DqEG6yq2.js";import{a as n,u as ze,e as Fe}from"./vendor-Chun8WN8.js";import{c as v,l as Re,o as Ve,m as T,X as $e,t as De,w as F}from"./index-Q4v1UkCE.js";import{C as Ie}from"./ContentCard-CJCJ0UzO.js";import{U as qe}from"./users-QqLUhkTz.js";import{S as Be}from"./settings-C1Uz1SrL.js";import"./player-BLuYXUgV.js";const We=v("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]),Ae=v("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]),Ue=v("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),He=v("SkipBack",[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]]),Oe=v("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),Xe=v("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),Qe=v("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),_e=v("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),Ge=({open:M,onClose:u,onCreateParty:N,contentId:l,contentTitle:j})=>{const[w,y]=n.useState(`Soirée ${j||"de visionnage"}`),[C,L]=n.useState(!1),[p,k]=n.useState(5),[m,h]=n.useState(""),[d,R]=n.useState({}),b=()=>{const r={};return w.trim()||(r.partyName="Le nom de la soirée est requis"),(p<2||p>10)&&(r.maxParticipants="Le nombre de participants doit être entre 2 et 10"),R(r),Object.keys(r).length===0},f=()=>{b()&&(N({name:w,contentId:l,isPublic:C,maxParticipants:p,description:m.trim()||`Soirée de visionnage pour ${j}`,createdAt:new Date().toISOString()}),u())};return t.jsxs(be,{open:M,onClose:u,maxWidth:"sm",fullWidth:!0,children:[t.jsx(je,{children:"Créer une soirée de visionnage"}),t.jsx(we,{children:t.jsxs(G,{sx:{mt:2},children:[t.jsx(J,{fullWidth:!0,label:"Nom de la soirée",value:w,onChange:r=>y(r.target.value),error:!!d.partyName,helperText:d.partyName,margin:"normal"}),t.jsx(J,{fullWidth:!0,label:"Description (optionnelle)",value:m,onChange:r=>h(r.target.value),multiline:!0,rows:3,margin:"normal"}),t.jsxs(ke,{fullWidth:!0,margin:"normal",error:!!d.maxParticipants,children:[t.jsx(Ne,{children:"Nombre maximum de participants"}),t.jsx(Ce,{value:p,onChange:r=>k(Number(r.target.value)),label:"Nombre maximum de participants",children:[2,3,4,5,6,7,8,9,10].map(r=>t.jsxs(Se,{value:r,children:[r," participants"]},r))}),d.maxParticipants&&t.jsx(Pe,{children:d.maxParticipants})]}),t.jsxs(G,{sx:{mt:2},children:[t.jsx(Ee,{control:t.jsx(Te,{checked:C,onChange:r=>L(r.target.checked),color:"primary"}),label:"Soirée publique"}),t.jsx(Me,{variant:"caption",color:"text.secondary",display:"block",children:"Les soirées publiques peuvent être rejointes par n'importe quel utilisateur de FloDrama"})]})]})}),t.jsxs(Le,{children:[t.jsx(K,{onClick:u,color:"inherit",children:"Annuler"}),t.jsx(K,{onClick:f,color:"primary",variant:"contained",children:"Créer la soirée"})]})]})},at=()=>{const{type:M,id:u}=ze(),N=Fe(),l=n.useRef(null),j=n.useRef(null),w=n.useRef(null),y=n.useRef(null),{getItemById:C,getRecommendations:L,isLoading:p,error:k}=Re(),[m,h]=n.useState(!1),[d,R]=n.useState(0),[b,f]=n.useState(0),[r,W]=n.useState(1),[V,$]=n.useState(!1),[Y,A]=n.useState(!1),[Z,U]=n.useState(!0),[D,S]=n.useState(!1),[I,P]=n.useState(!1),[ee,te]=n.useState("auto"),[a,se]=n.useState(null),[o,ae]=n.useState(1),[H,ne]=n.useState([]),[ie,O]=n.useState(!1),[q,re]=n.useState([{id:"off",label:"Désactivés",language:"off",src:"",enabled:!0},{id:"fr",label:"Français",language:"fr",src:"/subtitles/fr.vtt",enabled:!1},{id:"en",label:"Anglais",language:"en",src:"/subtitles/en.vtt",enabled:!1},{id:"es",label:"Espagnol",language:"es",src:"/subtitles/es.vtt",enabled:!1}]),[B,oe]=n.useState("off"),E=n.useCallback(e=>{e>=1&&e<=((a==null?void 0:a.episodes)||1)&&(ae(e),f(0),h(!1),setTimeout(()=>{const s=l.current;s&&s.play().then(()=>h(!0)).catch(i=>console.error("Erreur de lecture:",i))},500))},[a]);n.useEffect(()=>{if(p||k)return;const e=C(u);if(e){se(e);const s=L(u);s.length>0&&ne(s[0].items||[]),e.subtitles&&re(i=>{const c=[...i];return c[0].enabled=!0,e.subtitles.forEach(g=>{const x=c.findIndex(z=>z.language===g.language);x!==-1&&(c[x].enabled=!0,c[x].src=g.src||c[x].src)}),c})}},[u,p,k,C,L]),n.useEffect(()=>{const e=l.current;if(!e)return;const s=setTimeout(()=>{e.play().then(()=>h(!0)).catch(ye=>console.error("Erreur de lecture automatique:",ye))},1500),i=()=>{f(e.currentTime)},c=()=>{R(e.duration)},g=()=>{h(!0)},x=()=>{h(!1)},z=()=>{W(e.volume),$(e.muted)},_=()=>{h(!1),a&&a.episodes&&o<a.episodes&&setTimeout(()=>{E(o+1)},5e3)};return e.addEventListener("timeupdate",i),e.addEventListener("durationchange",c),e.addEventListener("play",g),e.addEventListener("pause",x),e.addEventListener("volumechange",z),e.addEventListener("ended",_),()=>{clearTimeout(s),e&&(e.removeEventListener("timeupdate",i),e.removeEventListener("durationchange",c),e.removeEventListener("play",g),e.removeEventListener("pause",x),e.removeEventListener("volumechange",z),e.removeEventListener("ended",_))}},[a,o,E]),n.useEffect(()=>{const e=()=>{U(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{m&&(U(!1),S(!1),P(!1))},3e3)},s=j.current;return s&&(s.addEventListener("mousemove",e),s.addEventListener("touchstart",e)),()=>{s&&(s.removeEventListener("mousemove",e),s.removeEventListener("touchstart",e)),y.current&&clearTimeout(y.current)}},[m]);const le=()=>{const e=j.current;document.fullscreenElement?document.exitFullscreen().then(()=>{A(!1)}).catch(s=>{console.error("Erreur lors de la sortie du plein écran:",s)}):e.requestFullscreen().then(()=>{A(!0)}).catch(s=>{console.error("Erreur lors du passage en plein écran:",s)})},X=e=>{const s=Math.floor(e/60),i=Math.floor(e%60);return`${s}:${i<10?"0":""}${i}`},Q=()=>{const e=l.current;m?e.pause():e.play(),h(!m)},ce=()=>{const e=l.current;e.muted=!e.muted,$(!V)},de=e=>{const s=parseFloat(e.target.value),i=l.current;i.volume=s,W(s),$(s===0)},ue=e=>{const s=parseFloat(e.target.value),i=l.current;i.currentTime=s,f(s)},me=e=>{const s=w.current,i=s.getBoundingClientRect(),g=(e.clientX-i.left)/s.offsetWidth*d,x=l.current;x.currentTime=g,f(g)},he=e=>{te(e),S(!1);const s=l.current.currentTime;setTimeout(()=>{l.current.currentTime=s,m&&l.current.play()},100)},xe=e=>{oe(e),P(!1);const s=l.current;if(s&&(Array.from(s.textTracks).forEach(i=>{i.mode="disabled"}),e!=="off")){const i=Array.from(s.textTracks).find(c=>c.language===e);i&&(i.mode="showing")}},pe=()=>{const e=q.find(s=>s.id===B);return e?e.label:"Désactivés"};if(p)return t.jsx("div",{className:"flex items-center justify-center h-screen bg-black",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600 mx-auto"}),t.jsx("p",{className:"mt-4 text-white",children:"Chargement de la vidéo..."})]})});if(k||!a)return t.jsx("div",{className:"flex items-center justify-center h-screen bg-black",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-red-600 text-5xl mb-4",children:"⚠️"}),t.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Vidéo non disponible"}),t.jsx("p",{className:"text-gray-400 mb-6",children:k||"Cette vidéo n'existe pas ou a été supprimée."}),t.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded font-medium",onClick:()=>N("/"),children:"Retour à l'accueil"})]})});const fe=()=>a.episodes&&a.episodes>1?a.episode_videos&&a.episode_videos[o-1]?F(a.episode_videos[o-1]):F(`${a.id}/episode${o}.mp4`):a.video?F(a.video):F(`${a.id}/movie.mp4`),ge={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3}}},ve={hidden:{opacity:0,x:-20},visible:{opacity:1,x:0,transition:{duration:.3}}};return t.jsxs("div",{className:"bg-black h-screen w-screen overflow-hidden",children:[t.jsxs("div",{ref:j,className:"relative h-full w-full",onClick:()=>{!D&&!I&&Q()},children:[t.jsx("video",{ref:l,className:"h-full w-full object-contain",src:fe(),poster:Ve(a.banner||a.poster),preload:"auto",onClick:e=>e.stopPropagation(),children:q.filter(e=>e.id!=="off"&&e.enabled).map(e=>t.jsx("track",{kind:"subtitles",src:e.src,srcLang:e.language,label:e.label,default:e.id===B},e.id))}),Z&&t.jsxs(T.div,{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-black bg-opacity-50",initial:"hidden",animate:"visible",exit:"hidden",variants:ge,children:[t.jsx("div",{className:"absolute top-4 left-4 z-10",children:t.jsx("button",{className:"text-white hover:text-red-500 transition-colors",onClick:()=>N(`/${M}/${u}`),children:t.jsx($e,{size:24})})}),t.jsxs(T.div,{className:"absolute top-4 left-16 z-10",variants:ve,children:[t.jsx("h1",{className:"text-xl font-bold text-white",children:a.title}),a.episodes&&a.episodes>1&&t.jsxs("p",{className:"text-gray-300",children:["Épisode ",o]})]}),t.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4",children:[t.jsxs("div",{ref:w,className:"w-full h-1 bg-gray-600 rounded-full mb-4 cursor-pointer",onClick:me,children:[t.jsx("div",{className:"h-full bg-red-600 rounded-full relative",style:{width:`${b/d*100}%`},children:t.jsx("div",{className:"absolute right-0 top-1/2 transform -translate-y-1/2 w-3 h-3 bg-red-600 rounded-full"})}),t.jsx("input",{type:"range",min:"0",max:d||100,value:b,onChange:ue,className:"absolute inset-0 w-full opacity-0 cursor-pointer"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("button",{className:"text-white hover:text-red-500 transition-colors",onClick:e=>{e.stopPropagation(),Q()},children:m?t.jsx(Ue,{size:24}):t.jsx(De,{size:24})}),a.episodes&&a.episodes>1&&t.jsx("button",{className:`text-white hover:text-red-500 transition-colors ${o<=1?"opacity-50 cursor-not-allowed":""}`,onClick:e=>{e.stopPropagation(),o>1&&E(o-1)},disabled:o<=1,children:t.jsx(He,{size:20})}),a.episodes&&a.episodes>1&&t.jsx("button",{className:`text-white hover:text-red-500 transition-colors ${o>=a.episodes?"opacity-50 cursor-not-allowed":""}`,onClick:e=>{e.stopPropagation(),o<a.episodes&&E(o+1)},disabled:o>=a.episodes,children:t.jsx(Oe,{size:20})}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{className:"text-white hover:text-red-500 transition-colors",onClick:e=>{e.stopPropagation(),ce()},children:V?t.jsx(_e,{size:20}):t.jsx(Qe,{size:20})}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:V?0:r,onChange:de,className:"w-20 accent-red-600",onClick:e=>e.stopPropagation()})]}),t.jsxs("div",{className:"text-white text-sm",children:[X(b)," / ",X(d)]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"relative",children:[t.jsxs("button",{className:"text-white hover:text-red-500 transition-colors flex items-center space-x-1",onClick:e=>{e.stopPropagation(),P(!I),S(!1)},children:[t.jsx(Xe,{size:20}),t.jsx("span",{className:"text-sm hidden sm:inline",children:pe()})]}),I&&t.jsxs(T.div,{className:"absolute bottom-full right-0 mb-2 bg-gray-900 rounded-lg shadow-lg p-4 w-48",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"text-white font-medium mb-2",children:"Sous-titres"}),q.filter(e=>e.enabled).map(e=>t.jsx("button",{className:`flex items-center justify-between w-full py-2 px-2 rounded ${B===e.id?"bg-red-600 text-white":"text-gray-300 hover:bg-gray-800 hover:text-white"}`,onClick:()=>xe(e.id),children:e.label},e.id))]})]}),t.jsx("div",{className:"relative",children:t.jsx("button",{className:"text-white hover:text-red-500 transition-colors",onClick:e=>{e.stopPropagation(),O(!0),S(!1),P(!1)},children:t.jsx(qe,{size:20})})}),t.jsxs("div",{className:"relative",children:[t.jsx("button",{className:"text-white hover:text-red-500 transition-colors",onClick:e=>{e.stopPropagation(),S(!D),P(!1)},children:t.jsx(Be,{size:20})}),D&&t.jsxs(T.div,{className:"absolute bottom-full right-0 mb-2 bg-gray-900 rounded-lg shadow-lg p-4 w-48",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},onClick:e=>e.stopPropagation(),children:[t.jsx("div",{className:"text-white font-medium mb-2",children:"Paramètres"}),t.jsx("div",{className:"relative",children:t.jsxs("button",{className:"flex items-center justify-between w-full text-gray-300 hover:text-white py-2",onClick:()=>he("auto"),children:[t.jsx("span",{children:"Qualité"}),t.jsx("span",{className:"flex items-center",children:ee})]})}),t.jsxs("button",{className:"flex items-center justify-between w-full text-gray-300 hover:text-white py-2",children:[t.jsx("span",{children:"Vitesse"}),t.jsx("span",{children:"1x"})]})]})]}),t.jsx("button",{className:"text-white hover:text-red-500 transition-colors",onClick:e=>{e.stopPropagation(),le()},children:Y?t.jsx(Ae,{size:20}):t.jsx(We,{size:20})})]})]})]})]}),b>0&&b>=d-.5&&t.jsxs(T.div,{className:"absolute inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[t.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:a.episodes&&o<a.episodes?"Prochain épisode dans 5 secondes...":"Fin du contenu"}),a.episodes&&o<a.episodes?t.jsxs("div",{className:"flex space-x-4",children:[t.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded font-medium",onClick:()=>E(o+1),children:"Regarder maintenant"}),t.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded font-medium",onClick:()=>f(0),children:"Revoir"})]}):t.jsxs("div",{className:"flex space-x-4",children:[t.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded font-medium",onClick:()=>N(`/${M}/${u}`),children:"Détails"}),t.jsx("button",{className:"bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded font-medium",onClick:()=>f(0),children:"Revoir"})]}),H.length>0&&t.jsxs("div",{className:"mt-12 w-full max-w-4xl",children:[t.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Recommandations"}),t.jsx("div",{className:"flex space-x-4 overflow-x-auto pb-4",children:H.slice(0,5).map((e,s)=>t.jsx(Ie,{item:e,size:"sm",index:s},e.id))})]})]})]}),t.jsx(Ge,{open:ie,onClose:()=>O(!1),contentId:u,contentTitle:a==null?void 0:a.title})]})};export{at as default};
//# sourceMappingURL=VideoPlayerPage-B3uzwVI7.js.map
