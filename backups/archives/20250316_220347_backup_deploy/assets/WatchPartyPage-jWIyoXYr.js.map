{"version":3,"file":"WatchPartyPage-jWIyoXYr.js","sources":["../../src/pages/WatchPartyPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { \n  Box, \n  Typography, \n  CircularProgress, \n  Button, \n  Container, \n  Snackbar, \n  Alert\n} from '@mui/material';\nimport { styled } from '@mui/material/styles';\n\nimport WatchPartyContainer from '../components/watch-party/WatchPartyContainer';\nimport { useAuth } from '../hooks/useAuth';\nimport { useSubscription } from '../hooks/useSubscription';\nimport { copyToClipboard } from '../utils/clipboard';\n\n// Styles personnalisés\nconst MainContainer = styled(Container)(({ theme }) => ({\n  paddingTop: theme.spacing(3),\n  paddingBottom: theme.spacing(3),\n  height: '100vh',\n  display: 'flex',\n  flexDirection: 'column',\n}));\n\n/**\n * Page de soirée de visionnage (Watch Party)\n * Permet aux utilisateurs de regarder du contenu ensemble de manière synchronisée\n * Utilise react-native-gifted-chat pour l'interface de chat\n */\nconst WatchPartyPage = () => {\n  const { partyId, dramaId } = useParams();\n  const navigate = useNavigate();\n  const { user, isAuthenticated } = useAuth();\n  const { hasActiveSubscription, currentPlan } = useSubscription();\n  \n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [showSnackbar, setShowSnackbar] = useState(false);\n  const [snackbarMessage, setSnackbarMessage] = useState('');\n  const [snackbarSeverity, setSnackbarSeverity] = useState('info');\n  \n  // Vérifier si l'utilisateur a accès à la fonctionnalité\n  useEffect(() => {\n    if (isAuthenticated && !loading) {\n      // La fonctionnalité Watch Party est réservée aux abonnés Ultimate\n      if (!hasActiveSubscription || currentPlan !== 'ultimate') {\n        setError('La fonctionnalité Watch Party est disponible uniquement pour les abonnements Ultimate.');\n      }\n    }\n  }, [isAuthenticated, hasActiveSubscription, currentPlan, loading]);\n  \n  // Charger les détails du drama\n  useEffect(() => {\n    const loadDramaDetails = async () => {\n      try {\n        setLoading(true);\n        \n        // Simulation pour le développement - à remplacer par un appel API réel\n        setTimeout(() => {\n          setLoading(false);\n        }, 1500);\n        \n      } catch (err) {\n        console.error('Erreur lors du chargement des détails du drama:', err);\n        setError('Impossible de charger les détails du drama. Veuillez réessayer.');\n        setLoading(false);\n      }\n    };\n    \n    if (dramaId && partyId) {\n      loadDramaDetails();\n    }\n  }, [dramaId, partyId, user]);\n  \n  // Fermer la notification Snackbar\n  const handleCloseSnackbar = (event, reason) => {\n    if (reason === 'clickaway') return;\n    setShowSnackbar(false);\n  };\n\n  // Afficher un écran de chargement\n  if (loading) {\n    return (\n      <MainContainer>\n        <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '70vh' }}>\n          <CircularProgress size={60} />\n          <Typography variant=\"h6\" sx={{ mt: 3 }}>\n            Préparation de la Watch Party...\n          </Typography>\n        </Box>\n      </MainContainer>\n    );\n  }\n  \n  // Afficher un message d'erreur\n  if (error) {\n    return (\n      <MainContainer>\n        <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '70vh' }}>\n          <Typography variant=\"h5\" color=\"error\" gutterBottom>\n            Oups ! Un problème est survenu\n          </Typography>\n          <Typography variant=\"body1\" sx={{ mb: 3, textAlign: 'center' }}>\n            {error}\n          </Typography>\n          {!hasActiveSubscription && (\n            <Button \n              variant=\"contained\" \n              color=\"primary\" \n              onClick={() => navigate('/subscription')}\n              sx={{ mt: 2 }}\n            >\n              Découvrir les abonnements\n            </Button>\n          )}\n          <Button \n            variant=\"outlined\" \n            onClick={() => navigate(-1)}\n            sx={{ mt: 2 }}\n          >\n            Retour\n          </Button>\n        </Box>\n      </MainContainer>\n    );\n  }\n\n  // Utiliser le nouveau composant WatchPartyContainer pour une expérience complète\n  return (\n    <Box sx={{ height: '100vh', overflow: 'hidden' }}>\n      <WatchPartyContainer \n        partyId={partyId}\n        dramaId={dramaId}\n        onShareSuccess={(url) => {\n          copyToClipboard(url);\n          setSnackbarMessage('Lien de la Watch Party copié dans le presse-papiers !');\n          setSnackbarSeverity('success');\n          setShowSnackbar(true);\n        }}\n        onLeave={() => navigate(`/watch/${dramaId}`)}\n      />\n      \n      <Snackbar\n        open={showSnackbar}\n        autoHideDuration={6000}\n        onClose={handleCloseSnackbar}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}\n      >\n        <Alert onClose={handleCloseSnackbar} severity={snackbarSeverity} sx={{ width: '100%' }}>\n          {snackbarMessage}\n        </Alert>\n      </Snackbar>\n    </Box>\n  );\n};\n\nexport default WatchPartyPage;\n"],"names":["MainContainer","styled","Container","theme","WatchPartyPage","partyId","dramaId","useParams","navigate","useNavigate","user","isAuthenticated","useAuth","hasActiveSubscription","currentPlan","useSubscription","loading","setLoading","useState","error","setError","showSnackbar","setShowSnackbar","snackbarMessage","setSnackbarMessage","snackbarSeverity","setSnackbarSeverity","useEffect","err","handleCloseSnackbar","event","reason","jsxs","Box","jsx","CircularProgress","Typography","Button","WatchPartyContainer","url","copyToClipboard","Snackbar","Alert"],"mappings":"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"}